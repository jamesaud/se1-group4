{% extends "base.html" %}
{% load static %}
{% block css %}
<link href="//netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css" rel="stylesheet">

{{block.super}}
<link href="{% static 'css/job.css' %}" rel="stylesheet">
<link href="{% static 'css/searchBar.css' %}" rel="stylesheet">
{% endblock %}


{% block javascript %}
{{ block.super }}
  <script>
    function job_apply(event, job_id){
      $.ajax({
        type: "POST",
        url: "{% url 'job:jobApply'%}",
        data: {"job_id": job_id, 'csrfmiddlewaretoken': '{{ csrf_token }}'},
        dataType: "json",
        success: function(response) {
          document.getElementById(job_id).innerHTML = '<span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Applied'
        },
        error: function(rs,e){
          console.log(rs.responseText)
        }
      });
    }

  </script>
{% endblock %}


{% block content %}
 <section class="search-form">
    <form method="GET" name="search" role="search" action="{% url 'search:search' %}">
      <p class="inp-wrap search-wrap">
        <input type="search" name="q" id="search-field" class="grid-95" placeholder="e.g. Software Engineer" /></p>
      <p class="inp-wrap cat-wrap">
        <!--<label for="categories" class="grid-30">in</label>-->
        <select name="location" id="location" class="grid-100">
        {% for location in locations %}
          <option value='{{location.id}}' selected>{{location.city}}</option>
        {% endfor %}
        </select>
      </p>
            <p class="inp-wrap cat-wrap">
      <!--  <label for="categories" class="grid-30">in</label> -->
        <select name="employment_type" id="employment_type" class="grid-100">
        {% for position in positions %}
          <option value='{{position.0}}' selected>{{position.1}}</option>
        {% endfor %}
        </select>
        </p>
      <p class="inp-wrap submit-wrap">
        <button class="grid-100 btn-search">
          <span class="search-icon-container"><?xml version="1.0" encoding="utf-8"?>
          <!-- Generated by IcoMoon.io -->
          <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
          <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="search-icon" width="768" height="768" viewBox="0 0 768 768">
          <g id="icomoon-ignore">
          </g>
          <path d="M304.5 448.5c79.5 0 144-64.5 144-144s-64.5-144-144-144-144 64.5-144 144 64.5 144 144 144zM496.5 448.5l159 159-48 48-159-159v-25.5l-9-9c-36 31.5-84 49.5-135 49.5-115.5 0-208.5-91.5-208.5-207s93-208.5 208.5-208.5 207 93 207 208.5c0 51-18 99-49.5 135l9 9h25.5z"></path>
          </svg>
          </span>
          Search
        </button>
      </p>
    </form>
  </section> 

<h2>All Job Matches For You</h2>


  {% if jobs %}
      <ul class="list-group">
        {% for job in jobs %}
            		<ul id="timeline">
                          <a href="#">
                            <li class="listing clearfix">
                              <div class="image_wrapper">
                              <a href="{{job.user.get_absolute_url}}"><img src="{{ job.user.get_image_url }}" style="height: 58px; width: auto;" alt=""></a>
                              </div>
                              <div class="info">
                                <span class="job_title"><a href = "{% url 'job:job_detail' job.id %}"> {{job.post_name}}</a></span>
                                <span class="job_info">{{job.user.employer.company_name}} <span>&bull;</span> {{job.location.city}},{{job.location.state}} <span>&bull;</span> {{job.created_at|date:'D-F-o'}}</span>
                              </div>
                                {% if job.employment_type == 'FULL_TIME' %}
                                    <span class="job_type full_time">{{job.employment_type}}</span>
                                {% else %}
                                    <span class="job_type part_time">{{job.employment_type}}</span>
                                {% endif%}
                              <span class="job_type freelance">{{job.match_percent|floatformat}}% Match</span>
                              {% if job.applied %}
                                  <span class="apply_span" id="{{job.id}}">
                                  <span class="glyphicon glyphicon-ok" aria-hidden="true"></span> Applied
                                  </span>
                              {% else %}
                              <span class="apply_span" id="{{job.id}}">
                        <button id="apply" class="btn btn-default" onclick="job_apply(event,{{job.id}})"><span class="glyphicon glyphicon-envelope" aria-hidden="true"></span> Apply</button>
                              </span>
                              {% endif %}
                            </li>
                          </a>
                     </ul>
        {% endfor %}
    {% else %}
      <p> No jobs have been posted. </p>

  {% endif %}

{% endblock content %}
